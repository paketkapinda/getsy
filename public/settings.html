<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Settings ‚Äì Etsy AI POD</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/assets/css/styles.css" />

<style>
/* Settings Page Styles */
.settings-container {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
  gap: 1.5rem;
  margin-bottom: 2rem;
}

.settings-card {
  background: white;
  border: 1px solid #e5e7eb;
  border-radius: 12px;
  padding: 1.5rem;
  transition: all 0.3s ease;
}

.settings-card:hover {
  border-color: #ea580c;
  box-shadow: 0 4px 12px rgba(234, 88, 12, 0.1);
}

.settings-card-header {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  margin-bottom: 1.25rem;
  padding-bottom: 0.75rem;
  border-bottom: 1px solid #f3f4f6;
}

.settings-card-icon {
  width: 2.5rem;
  height: 2.5rem;
  background: linear-gradient(135deg, #ea580c, #c2410c);
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}

.settings-card-icon svg {
  width: 1.25rem;
  height: 1.25rem;
  color: white;
}

.settings-card-title {
  font-size: 1.125rem;
  font-weight: 600;
  color: #111827;
  margin-bottom: 0.25rem;
}

.settings-card-subtitle {
  font-size: 0.875rem;
  color: #6b7280;
}

.settings-list {
  margin-bottom: 1.5rem;
}

.settings-list-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0.75rem 0;
  border-bottom: 1px solid #f3f4f6;
}

.settings-list-item:last-child {
  border-bottom: none;
}

.settings-list-item-info {
  flex: 1;
}

.settings-list-item-name {
  font-size: 0.875rem;
  font-weight: 500;
  color: #111827;
  margin-bottom: 0.125rem;
}

.settings-list-item-desc {
  font-size: 0.75rem;
  color: #6b7280;
}

.settings-list-item-actions {
  display: flex;
  gap: 0.5rem;
}

.settings-btn {
  padding: 0.5rem 1rem;
  border-radius: 6px;
  font-size: 0.75rem;
  font-weight: 500;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  gap: 0.375rem;
  border: 1px solid transparent;
  cursor: pointer;
}

.settings-btn-primary {
  background: #ea580c;
  color: white;
  border: none;
}

.settings-btn-primary:hover {
  background: #c2410c;
}

.settings-btn-outline {
  background: white;
  color: #374151;
  border: 1px solid #d1d5db;
}

.settings-btn-outline:hover {
  border-color: #ea580c;
  color: #ea580c;
}

.settings-btn-danger {
  background: white;
  color: #dc2626;
  border: 1px solid #dc2626;
}

.settings-btn-danger:hover {
  background: #dc2626;
  color: white;
}

.settings-form {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.settings-form-group {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.settings-form-label {
  font-size: 0.875rem;
  font-weight: 500;
  color: #374151;
}

.settings-form-input {
  padding: 0.75rem 1rem;
  border: 1px solid #d1d5db;
  border-radius: 8px;
  font-size: 0.875rem;
  transition: all 0.3s ease;
}

.settings-form-input:focus {
  outline: none;
  border-color: #ea580c;
  box-shadow: 0 0 0 3px rgba(234, 88, 12, 0.1);
}

.settings-form-textarea {
  min-height: 100px;
  resize: vertical;
}

.settings-empty-state {
  text-align: center;
  padding: 2rem 1rem;
  color: #6b7280;
}

.settings-empty-state svg {
  width: 3rem;
  height: 3rem;
  margin: 0 auto 1rem;
  color: #d1d5db;
}

.settings-empty-state-title {
  font-size: 1rem;
  font-weight: 500;
  margin-bottom: 0.25rem;
}

.settings-empty-state-description {
  font-size: 0.875rem;
}

/* Connection Status Styles */
.connection-status {
  font-size: 0.75rem;
  font-weight: 500;
  margin-left: 0.5rem;
  padding: 0.125rem 0.5rem;
  border-radius: 9999px;
}

.connection-status.connected {
  background: #dcfce7;
  color: #166534;
}

.connection-status.disconnected {
  background: #fee2e2;
  color: #991b1b;
}

/* Modal Styles */
.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0,0,0,0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

.modal-content {
  background: white;
  border-radius: 12px;
  padding: 0;
  min-width: 400px;
  max-width: 500px;
  box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1);
  max-height: 90vh;
  overflow-y: auto;
}

.modal-header {
  padding: 1.5rem;
  border-bottom: 1px solid #e5e7eb;
  display: flex;
  justify-content: space-between;
  align-items: center;
  position: sticky;
  top: 0;
  background: white;
  z-index: 10;
}

.modal-title {
  font-size: 1.25rem;
  font-weight: 600;
  color: #111827;
  margin: 0;
}

.modal-close {
  background: none;
  border: none;
  font-size: 1.5rem;
  cursor: pointer;
  color: #6b7280;
  padding: 0;
  width: 30px;
  height: 30px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.modal-body {
  padding: 1.5rem;
}

.modal-footer {
  padding: 1.5rem;
  border-top: 1px solid #e5e7eb;
  display: flex;
  gap: 0.75rem;
  justify-content: flex-end;
}

/* AI Tools Grid */
.ai-tools-grid {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.ai-tool-card {
  border: 1px solid #e5e7eb;
  border-radius: 8px;
  padding: 1rem;
  transition: all 0.3s ease;
}

.ai-tool-card.active {
  border-color: #ea580c;
  background-color: #fff7ed;
}

.ai-tool-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1rem;
}

.ai-tool-name {
  margin: 0;
  font-size: 1rem;
  font-weight: 600;
}

.ai-tool-provider {
  margin: 0;
  color: #6b7280;
  font-size: 0.875rem;
}

/* Toggle Switch */
.toggle-switch {
  position: relative;
  display: inline-block;
  width: 44px;
  height: 24px;
}

.toggle-switch input {
  opacity: 0;
  width: 0;
  height: 0;
}

.toggle-slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #ccc;
  transition: .4s;
  border-radius: 24px;
}

.toggle-slider:before {
  position: absolute;
  content: "";
  height: 16px;
  width: 16px;
  left: 4px;
  bottom: 4px;
  background-color: white;
  transition: .4s;
  border-radius: 50%;
}

.toggle-switch input:checked + .toggle-slider {
  background-color: #ea580c;
}

.toggle-switch input:checked + .toggle-slider:before {
  transform: translateX(20px);
}

/* Animations */
@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.spinner {
  animation: spin 1s linear infinite;
}

/* Responsive */
@media (max-width: 768px) {
  .settings-container {
    grid-template-columns: 1fr;
  }
  
  .settings-card {
    padding: 1.25rem;
  }
  
  .settings-list-item {
    flex-direction: column;
    align-items: flex-start;
    gap: 0.75rem;
  }
  
  .settings-list-item-actions {
    width: 100%;
    justify-content: flex-end;
  }

  .modal-content {
    min-width: 90%;
    margin: 1rem;
  }
}

@media (max-width: 480px) {
  .settings-card-header {
    flex-direction: column;
    text-align: center;
    gap: 0.5rem;
  }

  .modal-content {
    min-width: 95%;
  }
}
</style>

  </head>
  
  <body class="dashboard-container">
    <div class="dashboard-layout">
      <!-- Sidebar -->
      <aside class="dashboard-sidebar">
        <div class="sidebar-header">
          <div class="sidebar-logo">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
            </svg>
          </div>
          <div>
            <div class="sidebar-title">Etsy AI POD</div>
            <div class="sidebar-subtitle">PREMIUM PLATFORM</div>
          </div>
        </div>

        <nav class="sidebar-nav">
          <a href="/dashboard.html" class="sidebar-nav-item">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
            </svg>
            Dashboard
          </a>
          <a href="/products.html" class="sidebar-nav-item">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"/>
            </svg>
            Products
          </a>
          <a href="/orders.html" class="sidebar-nav-item">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/>
            </svg>
            Orders
          </a>
           <a href="/payments.html" class="sidebar-nav-item">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"/>
            </svg>
            Payments
          </a>
          <a href="/ai-assistant.html" class="sidebar-nav-item">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
            </svg>
            AI Assistant
          </a>
          <a href="/settings.html" class="sidebar-nav-item active">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
            </svg>
            Settings
          </a>
        </nav>

        <div class="sidebar-user">
          <div style="display: flex; align-items: center; gap: 12px;">
            <div class="user-avatar">JD</div>
            <div>
              <div style="font-weight: 600; color: #18181b;">John Doe</div>
              <div style="font-size: 12px; color: #6b7280;">admin@example.com</div>
            </div>
          </div>
        </div>
      </aside>

      <!-- Main Content -->
      <main class="dashboard-main">
        <!-- Header -->
        <header class="products-header">
          <div class="products-title">
            <h1>Settings</h1>
            <p>Manage your account and platform preferences</p>
          </div>
        </header>

        <!-- Settings Grid -->
        <div class="settings-container">
          <!-- Etsy Shops -->
          <div class="settings-card">
            <div class="settings-card-header">
              <div class="settings-card-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"/>
                </svg>
              </div>
              <div>
                <h3 class="settings-card-title">Etsy Shops</h3>
                <p class="settings-card-subtitle">Manage your connected Etsy shops</p>
              </div>
            </div>
            
            <div class="settings-list" id="etsy-shops-list">
              <div class="settings-empty-state">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"/>
                </svg>
                <div class="settings-empty-state-title">No Etsy shops connected</div>
                <div class="settings-empty-state-description">Connect your first Etsy shop to get started</div>
              </div>
            </div>
            
            <button id="btn-connect-etsy" class="settings-btn settings-btn-primary">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="16" height="16">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
              </svg>
              Connect Etsy Shop
            </button>
          </div>

          <!-- POD Providers -->
          <div class="settings-card">
            <div class="settings-card-header">
              <div class="settings-card-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
                </svg>
              </div>
              <div>
                <h3 class="settings-card-title">POD Providers</h3>
                <p class="settings-card-subtitle">Manage your print-on-demand providers</p>
              </div>
            </div>
            
            <div class="settings-list" id="pod-providers-list">
              <div class="settings-empty-state">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
                </svg>
                <div class="settings-empty-state-title">No POD providers added</div>
                <div class="settings-empty-state-description">Add your first POD provider to start selling</div>
              </div>
            </div>
            
            <button id="btn-add-pod" class="settings-btn settings-btn-outline">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="16" height="16">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
              </svg>
              Add POD Provider
            </button>
          </div>

          <!-- Payment Settings - Modal Version -->
          <div class="settings-card">
            <div class="settings-card-header">
              <div class="settings-card-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"/>
                </svg>
              </div>
              <div>
                <h3 class="settings-card-title">Payment Settings</h3>
                <p class="settings-card-subtitle">Configure your payment providers</p>
              </div>
            </div>
            
            <div class="settings-list">
              <div class="settings-empty-state">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"/>
                </svg>
                <div class="settings-empty-state-title">Payment settings not configured</div>
                <div class="settings-empty-state-description">Click the button below to configure payment settings</div>
              </div>
            </div>
            
            <button id="btn-payment-settings" class="settings-btn settings-btn-outline">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="16" height="16">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
              </svg>
              Configure Payment Settings
            </button>
          </div>

          <!-- AI Design Tools - Modal Version -->
          <div class="settings-card">
            <div class="settings-card-header">
              <div class="settings-card-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                </svg>
              </div>
              <div>
                <h3 class="settings-card-title">AI Design Tools</h3>
                <p class="settings-card-subtitle">Configure AI tools for design and content</p>
              </div>
            </div>
            
            <div class="settings-list">
              <div id="ai-tools-status" style="padding: 1rem; background: #f8fafc; border-radius: 8px; margin-bottom: 1rem;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                  <div>
                    <h4 style="margin: 0 0 0.25rem 0; font-size: 0.875rem; font-weight: 600;">AI Tools Status</h4>
                    <p style="margin: 0; font-size: 0.75rem; color: #6b7280;" id="active-tools-count">Loading...</p>
                  </div>
                  <button id="btn-test-connections" class="settings-btn settings-btn-outline" style="font-size: 0.75rem;">
                    Test Connections
                  </button>
                </div>
              </div>
              
              <div class="settings-list-item">
                <div class="settings-list-item-info">
                  <div class="settings-list-item-name">AI Design Tools</div>
                  <div class="settings-list-item-desc">Configure visual design AI tools (DALL-E, Midjourney, etc.)</div>
                </div>
                <div class="settings-list-item-actions">
                  <button id="btn-manage-design-tools" class="settings-btn settings-btn-outline">
                    Manage
                  </button>
                </div>
              </div>
              
              <div class="settings-list-item">
                <div class="settings-list-item-info">
                  <div class="settings-list-item-name">AI Content Tools</div>
                  <div class="settings-list-item-desc">Configure content creation AI tools (GPT, Claude, etc.)</div>
                </div>
                <div class="settings-list-item-actions">
                  <button id="btn-manage-content-tools" class="settings-btn settings-btn-outline">
                    Manage
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Team Members -->
          <div class="settings-card">
            <div class="settings-card-header">
              <div class="settings-card-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"/>
                </svg>
              </div>
              <div>
                <h3 class="settings-card-title">Team Members</h3>
                <p class="settings-card-subtitle">Manage your team members</p>
              </div>
            </div>
            
            <div class="settings-list" id="team-members-list">
              <div class="settings-empty-state">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"/>
                </svg>
                <div class="settings-empty-state-title">No team members</div>
                <div class="settings-empty-state-description">Invite team members to collaborate</div>
              </div>
            </div>
            
            <button id="btn-invite-member" class="settings-btn settings-btn-outline">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="16" height="16">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
              </svg>
              Invite Team Member
            </button>
          </div>
        </div>
      </main>
    </div>

    <!-- JavaScript -->
    <script src="/assets/js/env.js"></script>
    
    <!-- Inline Script - T√ºm mantƒ±k burada -->
    <script>
    // Global supabase deƒüi≈ükeni
    let supabase = null;

    // Sayfa y√ºklendiƒüinde
    document.addEventListener('DOMContentLoaded', async function() {
      console.log('üèÅ Settings page loaded');
      
      // Supabase'i y√ºkle
      await loadSupabase();
      
      // Event listener'larƒ± kur
      setupEventListeners();
      
      // AI Tools durumunu y√ºkle
      loadAIToolsStatus();
      
      // Etsy shops listesini y√ºkle
      loadEtsyShops();
      
      // POD providers listesini y√ºkle
      loadPODProviders();
      
      // Team members listesini y√ºkle
      loadTeamMembers();
      
      console.log('‚úÖ Settings page initialized');
    });

    // Supabase'i y√ºkle
    async function loadSupabase() {
      try {
        // env.js'den credential'larƒ± bekle
        if (!window.SUPABASE_URL || !window.SUPABASE_ANON_KEY) {
          console.log('‚è≥ Waiting for env.js to load credentials...');
          await new Promise(resolve => {
            const checkInterval = setInterval(() => {
              if (window.SUPABASE_URL && window.SUPABASE_ANON_KEY) {
                clearInterval(checkInterval);
                resolve();
              }
            }, 100);
          });
        }

        // Supabase client'ƒ±nƒ± dinamik olarak import et
        const { createClient } = await import('https://esm.sh/@supabase/supabase-js@2.48.0');
        supabase = createClient(window.SUPABASE_URL, window.SUPABASE_ANON_KEY, {
          auth: {
            persistSession: true,
          },
        });
        
        console.log('‚úÖ Supabase loaded successfully');
        
        // Kullanƒ±cƒ±yƒ± kontrol et
        const { data: { user } } = await supabase.auth.getUser();
        if (user) {
          console.log('üë§ User:', user.id);
        } else {
          console.log('üë§ No user logged in');
        }
        
      } catch (error) {
        console.error('‚ùå Error loading Supabase:', error);
        showNotification('Error connecting to database', 'error');
      }
    }

    // Event listener'larƒ± kur
    function setupEventListeners() {
      // AI Design Tools butonu
      document.getElementById('btn-manage-design-tools')?.addEventListener('click', () => {
        showAIToolModal('design');
      });
      
      // AI Content Tools butonu
      document.getElementById('btn-manage-content-tools')?.addEventListener('click', () => {
        showAIToolModal('content');
      });
      
      // Payment Settings butonu
      document.getElementById('btn-payment-settings')?.addEventListener('click', () => {
        showPaymentSettingsModal();
      });
      
      // Test Connections butonu
      document.getElementById('btn-test-connections')?.addEventListener('click', testAIConnections);
      
      // Etsy Connect butonu
      document.getElementById('btn-connect-etsy')?.addEventListener('click', () => {
        showEtsyConnectionModal();
      });
      
      // POD Provider butonu
      document.getElementById('btn-add-pod')?.addEventListener('click', () => {
        showPODProviderModal();
      });
      
      // Team Member butonu
      document.getElementById('btn-invite-member')?.addEventListener('click', () => {
        showInviteTeamMemberModal();
      });
    }

    // Etsy shops listesini y√ºkle
    async function loadEtsyShops() {
      try {
        if (!supabase) return;
        
        const { data: { user } } = await supabase.auth.getUser();
        if (!user) return;

        // etsy_shops tablosundan verileri √ßek
        const { data: etsyShops, error } = await supabase
          .from('etsy_shops')
          .select('*')
          .eq('user_id', user.id)
          .order('created_at', { ascending: false });

        if (error) {
          console.error('Error loading Etsy shops:', error);
          return;
        }

        const etsyShopsList = document.getElementById('etsy-shops-list');
        if (!etsyShopsList) return;

        if (etsyShops && etsyShops.length > 0) {
          etsyShopsList.innerHTML = '';
          
          etsyShops.forEach(shop => {
            const shopItem = document.createElement('div');
            shopItem.className = 'settings-list-item';
            shopItem.innerHTML = `
              <div class="settings-list-item-info">
                <div class="settings-list-item-name">${shop.shop_name || 'Unnamed Shop'}</div>
                <div class="settings-list-item-desc">
                  ${shop.shop_url || 'No URL'} ‚Ä¢ ${shop.is_active ? 'Active' : 'Inactive'}
                </div>
              </div>
              <div class="settings-list-item-actions">
                <button class="settings-btn settings-btn-outline" onclick="editEtsyShop('${shop.id}')">
                  Edit
                </button>
                <button class="settings-btn settings-btn-danger" onclick="deleteEtsyShop('${shop.id}')">
                  Disconnect
                </button>
              </div>
            `;
            etsyShopsList.appendChild(shopItem);
          });
        } else {
          // Liste zaten empty state g√∂steriyor
        }
        
      } catch (error) {
        console.error('Error loading Etsy shops:', error);
      }
    }

    // POD providers listesini y√ºkle
    async function loadPODProviders() {
      try {
        if (!supabase) return;
        
        const { data: { user } } = await supabase.auth.getUser();
        if (!user) return;

        // pod_providers tablosundan verileri √ßek
        const { data: podProviders, error } = await supabase
          .from('pod_providers')
          .select('*')
          .eq('user_id', user.id)
          .order('created_at', { ascending: false });

        if (error) {
          console.error('Error loading POD providers:', error);
          return;
        }

        const podProvidersList = document.getElementById('pod-providers-list');
        if (!podProvidersList) return;

        if (podProviders && podProviders.length > 0) {
          podProvidersList.innerHTML = '';
          
          podProviders.forEach(provider => {
            const providerItem = document.createElement('div');
            providerItem.className = 'settings-list-item';
            providerItem.innerHTML = `
              <div class="settings-list-item-info">
                <div class="settings-list-item-name">${provider.provider_name || 'Unnamed Provider'}</div>
                <div class="settings-list-item-desc">
                  ${provider.provider_type || 'Unknown'} ‚Ä¢ ${provider.is_active ? 'Active' : 'Inactive'}
                </div>
              </div>
              <div class="settings-list-item-actions">
                <button class="settings-btn settings-btn-outline" onclick="editPODProvider('${provider.id}')">
                  Edit
                </button>
                <button class="settings-btn settings-btn-danger" onclick="deletePODProvider('${provider.id}')">
                  Remove
                </button>
              </div>
            `;
            podProvidersList.appendChild(providerItem);
          });
        }
        
      } catch (error) {
        console.error('Error loading POD providers:', error);
      }
    }

    // Team members listesini y√ºkle
    async function loadTeamMembers() {
      try {
        if (!supabase) return;
        
        const { data: { user } } = await supabase.auth.getUser();
        if (!user) return;

        // team_members tablosundan verileri √ßek
        const { data: teamMembers, error } = await supabase
          .from('team_members')
          .select('*')
          .eq('user_id', user.id)
          .order('created_at', { ascending: false });

        if (error) {
          console.error('Error loading team members:', error);
          return;
        }

        const teamMembersList = document.getElementById('team-members-list');
        if (!teamMembersList) return;

        if (teamMembers && teamMembers.length > 0) {
          teamMembersList.innerHTML = '';
          
          teamMembers.forEach(member => {
            const memberItem = document.createElement('div');
            memberItem.className = 'settings-list-item';
            memberItem.innerHTML = `
              <div class="settings-list-item-info">
                <div class="settings-list-item-name">${member.name || 'Unnamed Member'}</div>
                <div class="settings-list-item-desc">
                  ${member.email || 'No email'} ‚Ä¢ ${member.role || 'Member'} ‚Ä¢ ${member.is_active ? 'Active' : 'Inactive'}
                </div>
              </div>
              <div class="settings-list-item-actions">
                <button class="settings-btn settings-btn-outline" onclick="editTeamMember('${member.id}')">
                  Edit
                </button>
                <button class="settings-btn settings-btn-danger" onclick="removeTeamMember('${member.id}')">
                  Remove
                </button>
              </div>
            `;
            teamMembersList.appendChild(memberItem);
          });
        }
        
      } catch (error) {
        console.error('Error loading team members:', error);
      }
    }

    // AI Tools durumunu y√ºkle
    async function loadAIToolsStatus() {
      try {
        if (!supabase) {
          console.error('‚ùå Supabase not loaded');
          return;
        }

        const { data: { user } } = await supabase.auth.getUser();
        if (!user) {
          document.getElementById('active-tools-count').textContent = 'Please login';
          return;
        }

        // ai_tools tablosundan verileri √ßek
        const { data: aiTools, error } = await supabase
          .from('ai_tools')
          .select('*')
          .eq('user_id', user.id);

        if (error) {
          console.error('‚ùå Error loading AI tools:', error);
          document.getElementById('active-tools-count').textContent = 'Error loading';
          return;
        }

        if (aiTools && aiTools.length > 0) {
          const activeTools = aiTools.filter(tool => tool.is_active);
          const designTools = aiTools.filter(tool => tool.tool_type === 'design');
          const contentTools = aiTools.filter(tool => tool.tool_type === 'content');
          
          const countElement = document.getElementById('active-tools-count');
          if (countElement) {
            countElement.textContent = 
              `${activeTools.length} active (${designTools.length} design, ${contentTools.length} content)`;
          }
        } else {
          document.getElementById('active-tools-count').textContent = 'No tools configured';
        }
        
      } catch (error) {
        console.error('‚ùå Error loading AI tools status:', error);
        document.getElementById('active-tools-count').textContent = 'Error';
      }
    }

    // Etsy Connection modalƒ±nƒ± g√∂ster
    function showEtsyConnectionModal() {
      const modalHtml = `
        <div class="modal-overlay">
          <div class="modal-content">
            <div class="modal-header">
              <h3 class="modal-title">Connect Etsy Shop</h3>
              <button class="modal-close" onclick="closeModal()">√ó</button>
            </div>
            <div class="modal-body">
              <form id="etsy-connection-form" class="settings-form">
                <div class="settings-form-group">
                  <label class="settings-form-label">Shop Name *</label>
                  <input
                    type="text"
                    id="etsy-shop-name"
                    placeholder="My Etsy Shop"
                    class="settings-form-input"
                    required
                  />
                </div>
                
                <div class="settings-form-group">
                  <label class="settings-form-label">Etsy Shop URL</label>
                  <input
                    type="url"
                    id="etsy-shop-url"
                    placeholder="https://www.etsy.com/shop/yourshop"
                    class="settings-form-input"
                  />
                </div>
                
                <div class="settings-form-group">
                  <label class="settings-form-label">API Key *</label>
                  <input
                    type="password"
                    id="etsy-api-key"
                    placeholder="Enter your Etsy API key"
                    class="settings-form-input"
                    required
                  />
                  <p style="font-size: 0.75rem; color: #6b7280;">
                    Get your API key from Etsy Developer Portal
                  </p>
                </div>
                
                <div class="settings-form-group">
                  <label class="settings-form-label">Shared Secret *</label>
                  <input
                    type="password"
                    id="etsy-shared-secret"
                    placeholder="Enter your shared secret"
                    class="settings-form-input"
                    required
                  />
                </div>
                
                <div class="settings-form-group">
                  <div style="display: flex; align-items: center; gap: 0.5rem;">
                    <input type="checkbox" id="etsy-active" checked style="width: auto;">
                    <label class="settings-form-label" for="etsy-active">Active</label>
                  </div>
                </div>
              </form>
            </div>
            <div class="modal-footer">
              <button type="button" class="settings-btn settings-btn-outline" onclick="closeModal()">
                Cancel
              </button>
              <button type="button" class="settings-btn settings-btn-primary" onclick="saveEtsyConnection()">
                Connect Shop
              </button>
            </div>
          </div>
        </div>
      `;
      
      document.body.insertAdjacentHTML('beforeend', modalHtml);
    }

    // POD Provider modalƒ±nƒ± g√∂ster
    function showPODProviderModal() {
      const modalHtml = `
        <div class="modal-overlay">
          <div class="modal-content">
            <div class="modal-header">
              <h3 class="modal-title">Add POD Provider</h3>
              <button class="modal-close" onclick="closeModal()">√ó</button>
            </div>
            <div class="modal-body">
              <form id="pod-provider-form" class="settings-form">
                <div class="settings-form-group">
                  <label class="settings-form-label">Provider Name *</label>
                  <input
                    type="text"
                    id="pod-provider-name"
                    placeholder="Printful, Printify, etc."
                    class="settings-form-input"
                    required
                  />
                </div>
                
                <div class="settings-form-group">
                  <label class="settings-form-label">Provider Type *</label>
                  <select id="pod-provider-type" class="settings-form-input" required>
                    <option value="">Select type</option>
                    <option value="printful">Printful</option>
                    <option value="printify">Printify</option>
                    <option value="gooten">Gooten</option>
                    <option value="teespring">Teespring</option>
                    <option value="redbubble">Redbubble</option>
                    <option value="custom">Custom</option>
                  </select>
                </div>
                
                <div class="settings-form-group">
                  <label class="settings-form-label">API Key *</label>
                  <input
                    type="password"
                    id="pod-api-key"
                    placeholder="Enter provider API key"
                    class="settings-form-input"
                    required
                  />
                </div>
                
                <div class="settings-form-group">
                  <label class="settings-form-label">API Secret (Optional)</label>
                  <input
                    type="password"
                    id="pod-api-secret"
                    placeholder="Enter API secret if required"
                    class="settings-form-input"
                  />
                </div>
                
                <div class="settings-form-group">
                  <label class="settings-form-label">Webhook URL (Optional)</label>
                  <input
                    type="url"
                    id="pod-webhook-url"
                    placeholder="https://yoursite.com/webhook/pod"
                    class="settings-form-input"
                  />
                </div>
                
                <div class="settings-form-group">
                  <div style="display: flex; align-items: center; gap: 0.5rem;">
                    <input type="checkbox" id="pod-active" checked style="width: auto;">
                    <label class="settings-form-label" for="pod-active">Active</label>
                  </div>
                </div>
              </form>
            </div>
            <div class="modal-footer">
              <button type="button" class="settings-btn settings-btn-outline" onclick="closeModal()">
                Cancel
              </button>
              <button type="button" class="settings-btn settings-btn-primary" onclick="savePODProvider()">
                Save Provider
              </button>
            </div>
          </div>
        </div>
      `;
      
      document.body.insertAdjacentHTML('beforeend', modalHtml);
    }

    // Invite Team Member modalƒ±nƒ± g√∂ster
    function showInviteTeamMemberModal() {
      const modalHtml = `
        <div class="modal-overlay">
          <div class="modal-content">
            <div class="modal-header">
              <h3 class="modal-title">Invite Team Member</h3>
              <button class="modal-close" onclick="closeModal()">√ó</button>
            </div>
            <div class="modal-body">
              <form id="team-member-form" class="settings-form">
                <div class="settings-form-group">
                  <label class="settings-form-label">Full Name *</label>
                  <input
                    type="text"
                    id="team-member-name"
                    placeholder="John Doe"
                    class="settings-form-input"
                    required
                  />
                </div>
                
                <div class="settings-form-group">
                  <label class="settings-form-label">Email Address *</label>
                  <input
                    type="email"
                    id="team-member-email"
                    placeholder="member@example.com"
                    class="settings-form-input"
                    required
                  />
                </div>
                
                <div class="settings-form-group">
                  <label class="settings-form-label">Role *</label>
                  <select id="team-member-role" class="settings-form-input" required>
                    <option value="">Select role</option>
                    <option value="admin">Administrator</option>
                    <option value="editor">Editor</option>
                    <option value="viewer">Viewer</option>
                    <option value="support">Support</option>
                  </select>
                </div>
                
                <div class="settings-form-group">
                  <label class="settings-form-label">Permissions</label>
                  <div style="display: flex; flex-direction: column; gap: 0.5rem; margin-top: 0.5rem;">
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                      <input type="checkbox" id="perm-products" checked style="width: auto;">
                      <label style="font-size: 0.875rem;">Manage Products</label>
                    </div>
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                      <input type="checkbox" id="perm-orders" checked style="width: auto;">
                      <label style="font-size: 0.875rem;">Manage Orders</label>
                    </div>
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                      <input type="checkbox" id="perm-settings" style="width: auto;">
                      <label style="font-size: 0.875rem;">Manage Settings</label>
                    </div>
                  </div>
                </div>
              </form>
            </div>
            <div class="modal-footer">
              <button type="button" class="settings-btn settings-btn-outline" onclick="closeModal()">
                Cancel
              </button>
              <button type="button" class="settings-btn settings-btn-primary" onclick="saveTeamMember()">
                Send Invitation
              </button>
            </div>
          </div>
        </div>
      `;
      
      document.body.insertAdjacentHTML('beforeend', modalHtml);
    }

    // AI Tool modalƒ±nƒ± g√∂ster
    function showAIToolModal(toolType = 'design') {
      const modalHtml = `
        <div class="modal-overlay">
          <div class="modal-content">
            <div class="modal-header">
              <h3 class="modal-title">${toolType === 'design' ? 'AI Design Tool' : 'AI Content Tool'}</h3>
              <button class="modal-close" onclick="closeModal()">√ó</button>
            </div>
            <div class="modal-body">
              <form id="ai-tool-form" class="settings-form">
                <div class="settings-form-group">
                  <label class="settings-form-label">Tool Name *</label>
                  <input
                    type="text"
                    id="tool-name"
                    placeholder="e.g., OpenAI DALL-E 3"
                    class="settings-form-input"
                    required
                  />
                </div>
                
                <div class="settings-form-group">
                  <label class="settings-form-label">Provider *</label>
                  <select id="tool-provider" class="settings-form-input" required>
                    <option value="">Select provider</option>
                    <option value="OpenAI">OpenAI</option>
                    <option value="Anthropic">Anthropic (Claude)</option>
                    <option value="Stability AI">Stability AI</option>
                    <option value="Midjourney">Midjourney</option>
                    <option value="Google">Google (Gemini)</option>
                    <option value="Other">Other</option>
                  </select>
                </div>
                
                <div class="settings-form-group">
                  <label class="settings-form-label">API Key *</label>
                  <input
                    type="password"
                    id="tool-api-key"
                    placeholder="Enter your API key"
                    class="settings-form-input"
                    required
                  />
                </div>
                
                <div class="settings-form-group">
                  <label class="settings-form-label">Tool Type</label>
                  <select id="tool-type" class="settings-form-input" required>
                    <option value="${toolType}" selected>${toolType === 'design' ? 'Design (Image Generation)' : 'Content (Text Generation)'}</option>
                    <option value="${toolType === 'design' ? 'content' : 'design'}">${toolType === 'design' ? 'Content (Text Generation)' : 'Design (Image Generation)'}</option>
                  </select>
                </div>
                
                <div class="settings-form-group">
                  <div style="display: flex; align-items: center; gap: 0.5rem;">
                    <input type="checkbox" id="tool-active" checked style="width: auto;">
                    <label class="settings-form-label" for="tool-active">Active</label>
                  </div>
                </div>
                
                <div class="settings-form-group">
                  <label class="settings-form-label">Configuration (Optional JSON)</label>
                  <textarea
                    id="tool-config"
                    placeholder='Example: {"model": "dall-e-3", "size": "1024x1024", "quality": "standard"}'
                    class="settings-form-input settings-form-textarea"
                    rows="4"
                  ></textarea>
                  <p style="font-size: 0.75rem; color: #6b7280;">
                    Additional configuration parameters in JSON format
                  </p>
                </div>
              </form>
            </div>
            <div class="modal-footer">
              <button type="button" class="settings-btn settings-btn-outline" onclick="closeModal()">
                Cancel
              </button>
              <button type="button" class="settings-btn settings-btn-primary" onclick="saveAITool('${toolType}')">
                Save Tool
              </button>
            </div>
          </div>
        </div>
      `;
      
      document.body.insertAdjacentHTML('beforeend', modalHtml);
    }

    // Payment Settings modalƒ±nƒ± g√∂ster
    function showPaymentSettingsModal() {
      const modalHtml = `
        <div class="modal-overlay">
          <div class="modal-content">
            <div class="modal-header">
              <h3 class="modal-title">Payment Settings</h3>
              <button class="modal-close" onclick="closeModal()">√ó</button>
            </div>
            <div class="modal-body">
              <form id="payment-settings-form" class="settings-form">
                <div class="settings-form-group">
                  <label class="settings-form-label">Wise API Key</label>
                  <input
                    type="password"
                    id="wise-api-key"
                    placeholder="Enter Wise API key"
                    class="settings-form-input"
                  />
                </div>
                <div class="settings-form-group">
                  <label class="settings-form-label">Payoneer API Key</label>
                  <input
                    type="password"
                    id="payoneer-api-key"
                    placeholder="Enter Payoneer API key"
                    class="settings-form-input"
                  />
                </div>
                <div class="settings-form-group">
                  <label class="settings-form-label">Bank Name</label>
                  <input
                    type="text"
                    id="bank-name"
                    placeholder="Enter bank name"
                    class="settings-form-input"
                  />
                </div>
                <div class="settings-form-group">
                  <label class="settings-form-label">IBAN</label>
                  <input
                    type="text"
                    id="iban"
                    placeholder="Enter IBAN"
                    class="settings-form-input"
                  />
                </div>
                <div class="settings-form-group">
                  <label class="settings-form-label">Swift Code</label>
                  <input
                    type="text"
                    id="swift-code"
                    placeholder="Enter SWIFT code"
                    class="settings-form-input"
                  />
                </div>
                <div class="settings-form-group">
                  <label class="settings-form-label">Account Holder Name</label>
                  <input
                    type="text"
                    id="account-holder"
                    placeholder="Enter account holder name"
                    class="settings-form-input"
                  />
                </div>
              </form>
            </div>
            <div class="modal-footer">
              <button type="button" class="settings-btn settings-btn-outline" onclick="closeModal()">
                Cancel
              </button>
              <button type="button" class="settings-btn settings-btn-primary" onclick="savePaymentSettings()">
                Save Payment Settings
              </button>
            </div>
          </div>
        </div>
      `;
      
      document.body.insertAdjacentHTML('beforeend', modalHtml);
      
      // √ñnceden kaydedilmi≈ü verileri y√ºkle
      loadPaymentSettings();
    }

    // Etsy Connection kaydet
    async function saveEtsyConnection() {
      try {
        console.log('üíæ Saving Etsy connection...');
        
        if (!supabase) {
          throw new Error('Database not connected');
        }

        const { data: { user } } = await supabase.auth.getUser();
        if (!user) {
          throw new Error('Please login to save settings');
        }

        const shopName = document.getElementById('etsy-shop-name').value.trim();
        const shopUrl = document.getElementById('etsy-shop-url').value.trim();
        const apiKey = document.getElementById('etsy-api-key').value.trim();
        const sharedSecret = document.getElementById('etsy-shared-secret').value.trim();
        const isActive = document.getElementById('etsy-active').checked;

        if (!shopName || !apiKey || !sharedSecret) {
          showNotification('Please fill in all required fields', 'error');
          return;
        }

        // Shop ID olu≈ütur
        const shopId = `etsy_${Date.now()}`;
        
        const etsyData = {
          id: shopId,
          user_id: user.id,
          shop_name: shopName,
          shop_url: shopUrl,
          api_key: apiKey,
          shared_secret: sharedSecret,
          is_active: isActive,
          updated_at: new Date().toISOString()
        };

        // √ñnce mevcut shop'u kontrol et (aynƒ± kullanƒ±cƒ± i√ßin)
        const { data: existingShop } = await supabase
          .from('etsy_shops')
          .select('id')
          .eq('user_id', user.id)
          .eq('shop_name', shopName)
          .single();

        let result;
        if (existingShop) {
          // UPDATE
          result = await supabase
            .from('etsy_shops')
            .update(etsyData)
            .eq('id', existingShop.id);
        } else {
          // INSERT
          result = await supabase
            .from('etsy_shops')
            .insert([etsyData]);
        }

        if (result.error) throw result.error;

        console.log('‚úÖ Etsy connection saved successfully');
        showNotification('Etsy shop connected successfully', 'success');
        
        // Modal'ƒ± kapat ve listeyi yenile
        closeModal();
        await loadEtsyShops();
        
      } catch (error) {
        console.error('‚ùå Error saving Etsy connection:', error);
        showNotification('Error: ' + error.message, 'error');
      }
    }

    // POD Provider kaydet
    async function savePODProvider() {
      try {
        console.log('üíæ Saving POD provider...');
        
        if (!supabase) {
          throw new Error('Database not connected');
        }

        const { data: { user } } = await supabase.auth.getUser();
        if (!user) {
          throw new Error('Please login to save settings');
        }

        const providerName = document.getElementById('pod-provider-name').value.trim();
        const providerType = document.getElementById('pod-provider-type').value;
        const apiKey = document.getElementById('pod-api-key').value.trim();
        const apiSecret = document.getElementById('pod-api-secret').value.trim();
        const webhookUrl = document.getElementById('pod-webhook-url').value.trim();
        const isActive = document.getElementById('pod-active').checked;

        if (!providerName || !providerType || !apiKey) {
          showNotification('Please fill in all required fields', 'error');
          return;
        }

        // Provider ID olu≈ütur
        const providerId = `pod_${providerType}_${Date.now()}`;
        
        const providerData = {
          id: providerId,
          user_id: user.id,
          provider_name: providerName,
          provider_type: providerType,
          api_key: apiKey,
          api_secret: apiSecret,
          webhook_url: webhookUrl,
          is_active: isActive,
          updated_at: new Date().toISOString()
        };

        // √ñnce mevcut provider'ƒ± kontrol et
        const { data: existingProvider } = await supabase
          .from('pod_providers')
          .select('id')
          .eq('user_id', user.id)
          .eq('provider_name', providerName)
          .single();

        let result;
        if (existingProvider) {
          // UPDATE
          result = await supabase
            .from('pod_providers')
            .update(providerData)
            .eq('id', existingProvider.id);
        } else {
          // INSERT
          result = await supabase
            .from('pod_providers')
            .insert([providerData]);
        }

        if (result.error) throw result.error;

        console.log('‚úÖ POD provider saved successfully');
        showNotification('POD provider added successfully', 'success');
        
        // Modal'ƒ± kapat ve listeyi yenile
        closeModal();
        await loadPODProviders();
        
      } catch (error) {
        console.error('‚ùå Error saving POD provider:', error);
        showNotification('Error: ' + error.message, 'error');
      }
    }

    // Team Member kaydet
    async function saveTeamMember() {
      try {
        console.log('üíæ Saving team member...');
        
        if (!supabase) {
          throw new Error('Database not connected');
        }

        const { data: { user } } = await supabase.auth.getUser();
        if (!user) {
          throw new Error('Please login to save settings');
        }

        const memberName = document.getElementById('team-member-name').value.trim();
        const memberEmail = document.getElementById('team-member-email').value.trim();
        const memberRole = document.getElementById('team-member-role').value;
        const permProducts = document.getElementById('perm-products').checked;
        const permOrders = document.getElementById('perm-orders').checked;
        const permSettings = document.getElementById('perm-settings').checked;

        if (!memberName || !memberEmail || !memberRole) {
          showNotification('Please fill in all required fields', 'error');
          return;
        }

        // Email validation
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(memberEmail)) {
          showNotification('Please enter a valid email address', 'error');
          return;
        }

        // Member ID olu≈ütur
        const memberId = `team_${Date.now()}`;
        
        const permissions = {
          manage_products: permProducts,
          manage_orders: permOrders,
          manage_settings: permSettings
        };
        
        const memberData = {
          id: memberId,
          user_id: user.id,
          name: memberName,
          email: memberEmail,
          role: memberRole,
          permissions: permissions,
          is_active: true,
          invitation_sent: new Date().toISOString(),
          updated_at: new Date().toISOString()
        };

        // √ñnce mevcut member'ƒ± kontrol et
        const { data: existingMember } = await supabase
          .from('team_members')
          .select('id')
          .eq('user_id', user.id)
          .eq('email', memberEmail)
          .single();

        let result;
        if (existingMember) {
          // UPDATE
          result = await supabase
            .from('team_members')
            .update(memberData)
            .eq('id', existingMember.id);
        } else {
          // INSERT
          result = await supabase
            .from('team_members')
            .insert([memberData]);
        }

        if (result.error) throw result.error;

        console.log('‚úÖ Team member saved successfully');
        showNotification('Invitation sent successfully', 'success');
        
        // Modal'ƒ± kapat ve listeyi yenile
        closeModal();
        await loadTeamMembers();
        
      } catch (error) {
        console.error('‚ùå Error saving team member:', error);
        showNotification('Error: ' + error.message, 'error');
      }
    }

    // Diƒüer fonksiyonlar (AI Tool kaydet, Payment Settings kaydet, test connections vs.) 
    // √∂nceki mesajdaki gibi aynƒ± kalacak, sadece fonksiyon isimlerini ekleyeceƒüim...

    // ... (AI Tool kaydetme, Payment Settings, Test Connections vs. fonksiyonlarƒ± buraya gelecek)

    async function loadPaymentSettings() {
      try {
        if (!supabase) return;
        
        const { data: { user } } = await supabase.auth.getUser();
        if (!user) return;

        const { data: paymentSettings } = await supabase
          .from('payment_settings')
          .select('*')
          .eq('user_id', user.id)
          .single();

        if (paymentSettings) {
          document.getElementById('wise-api-key').value = paymentSettings.wise_api_key || '';
          document.getElementById('payoneer-api-key').value = paymentSettings.payoneer_api_key || '';
          document.getElementById('bank-name').value = paymentSettings.bank_name || '';
          document.getElementById('iban').value = paymentSettings.iban || '';
          document.getElementById('swift-code').value = paymentSettings.swift_code || '';
          document.getElementById('account-holder').value = paymentSettings.account_holder || '';
        }
      } catch (error) {
        console.error('Error loading payment settings:', error);
      }
    }

    async function savePaymentSettings() {
      try {
        if (!supabase) {
          throw new Error('Database not connected');
        }

        const { data: { user } } = await supabase.auth.getUser();
        if (!user) {
          throw new Error('Please login to save settings');
        }

        const paymentData = {
          user_id: user.id,
          wise_api_key: document.getElementById('wise-api-key').value.trim(),
          payoneer_api_key: document.getElementById('payoneer-api-key').value.trim(),
          bank_name: document.getElementById('bank-name').value.trim(),
          iban: document.getElementById('iban').value.trim(),
          swift_code: document.getElementById('swift-code').value.trim(),
          account_holder: document.getElementById('account-holder').value.trim(),
          updated_at: new Date().toISOString()
        };

        // √ñnce mevcut kaydƒ± kontrol et
        const { data: existingSettings } = await supabase
          .from('payment_settings')
          .select('id')
          .eq('user_id', user.id)
          .single();

        let result;
        if (existingSettings) {
          // UPDATE
          result = await supabase
            .from('payment_settings')
            .update(paymentData)
            .eq('user_id', user.id);
        } else {
          // INSERT
          result = await supabase
            .from('payment_settings')
            .insert([paymentData]);
        }

        if (result.error) throw result.error;

        showNotification('Payment settings saved successfully', 'success');
        closeModal();
      } catch (error) {
        console.error('Error saving payment settings:', error);
        showNotification('Error: ' + error.message, 'error');
      }
    }

    async function saveAITool(toolType) {
      try {
        console.log('üíæ Saving AI Tool...');
        
        if (!supabase) {
          throw new Error('Database not connected');
        }

        const { data: { user } } = await supabase.auth.getUser();
        if (!user) {
          throw new Error('Please login to save settings');
        }

        const toolName = document.getElementById('tool-name').value.trim();
        const toolProvider = document.getElementById('tool-provider').value.trim();
        const toolApiKey = document.getElementById('tool-api-key').value.trim();
        const selectedToolType = document.getElementById('tool-type').value;
        const toolActive = document.getElementById('tool-active').checked;
        const toolConfig = document.getElementById('tool-config').value.trim();

        if (!toolName || !toolProvider || !toolApiKey) {
          showNotification('Please fill in all required fields', 'error');
          return;
        }

        // Tool ID olu≈ütur
        const toolId = `${selectedToolType}_${toolProvider.toLowerCase()}_${Date.now()}`;
        
        let configObj = {};
        if (toolConfig) {
          try {
            configObj = JSON.parse(toolConfig);
          } catch (e) {
            showNotification('Invalid JSON configuration', 'error');
            return;
          }
        }

        const toolData = {
          id: toolId,
          user_id: user.id,
          name: toolName,
          provider: toolProvider,
          is_active: toolActive,
          api_key: toolApiKey,
          tool_type: selectedToolType,
          config: configObj,
          updated_at: new Date().toISOString()
        };

        // √ñnce mevcut tool'u kontrol et (aynƒ± provider ve type ile)
        const { data: existingTool } = await supabase
          .from('ai_tools')
          .select('id')
          .eq('user_id', user.id)
          .eq('provider', toolProvider)
          .eq('tool_type', selectedToolType)
          .single();

        let result;
        if (existingTool) {
          // UPDATE
          console.log('üìù Updating existing AI tool');
          result = await supabase
            .from('ai_tools')
            .update(toolData)
            .eq('id', existingTool.id);
        } else {
          // INSERT
          console.log('üìù Inserting new AI tool');
          result = await supabase
            .from('ai_tools')
            .insert([toolData]);
        }

        if (result.error) {
          console.error('‚ùå Database error:', result.error);
          throw result.error;
        }

        console.log('‚úÖ AI Tool saved successfully');
        showNotification('AI Tool saved successfully', 'success');
        
        // Modal'ƒ± kapat ve listeyi yenile
        closeModal();
        await loadAIToolsStatus();
        
      } catch (error) {
        console.error('‚ùå Error saving AI Tool:', error);
        showNotification('Error: ' + error.message, 'error');
      }
    }

    // AI baƒülantƒ±larƒ±nƒ± test et
    async function testAIConnections() {
      const testBtn = document.getElementById('btn-test-connections');
      const originalText = testBtn.innerHTML;
      
      testBtn.innerHTML = `
        <div class="spinner" style="width: 16px; height: 16px; border: 2px solid #e5e7eb; border-top: 2px solid #ea580c; border-radius: 50%; animation: spin 1s linear infinite; margin-right: 8px;"></div>
        Testing...
      `;
      testBtn.disabled = true;

      try {
        if (!supabase) {
          throw new Error('Database not connected');
        }

        const { data: { user } } = await supabase.auth.getUser();
        if (!user) {
          throw new Error('Please login to test connections');
        }

        // AI Tools'larƒ± getir
        const { data: aiTools, error } = await supabase
          .from('ai_tools')
          .select('*')
          .eq('user_id', user.id)
          .eq('is_active', true);

        if (error) throw error;

        if (!aiTools || aiTools.length === 0) {
          showNotification('No active AI tools to test', 'info');
          testBtn.innerHTML = originalText;
          testBtn.disabled = false;
          return;
        }

        // Her tool i√ßin test yap (sim√ºle)
        let successfulTests = 0;
        let failedTests = 0;
        
        for (const tool of aiTools) {
          try {
            // Sim√ºle edilmi≈ü test
            await new Promise(resolve => setTimeout(resolve, 500));
            
            // Rastgele ba≈üarƒ±/ba≈üarƒ±sƒ±zlƒ±k (test i√ßin)
            const isSuccess = Math.random() > 0.3;
            
            if (isSuccess) {
              successfulTests++;
              console.log(`‚úÖ ${tool.name} connection test successful`);
            } else {
              failedTests++;
              console.log(`‚ùå ${tool.name} connection test failed`);
            }
          } catch (toolError) {
            failedTests++;
            console.error(`‚ùå Error testing ${tool.name}:`, toolError);
          }
        }
        
        if (failedTests === 0) {
          showNotification(`All ${successfulTests} connections tested successfully`, 'success');
        } else {
          showNotification(`${successfulTests} successful, ${failedTests} failed connections`, 'warning');
        }
        
      } catch (error) {
        console.error('Error testing connections:', error);
        showNotification('Error testing connections: ' + error.message, 'error');
      } finally {
        testBtn.innerHTML = originalText;
        testBtn.disabled = false;
      }
    }

    // Edit fonksiyonlarƒ± (placeholder)
    function editEtsyShop(shopId) {
      showNotification('Edit Etsy shop functionality coming soon', 'info');
    }

    function deleteEtsyShop(shopId) {
      if (confirm('Are you sure you want to disconnect this Etsy shop?')) {
        showNotification('Disconnecting Etsy shop...', 'info');
        // Ger√ßek delete i≈ülemi burada yapƒ±lacak
      }
    }

    function editPODProvider(providerId) {
      showNotification('Edit POD provider functionality coming soon', 'info');
    }

    function deletePODProvider(providerId) {
      if (confirm('Are you sure you want to remove this POD provider?')) {
        showNotification('Removing POD provider...', 'info');
        // Ger√ßek delete i≈ülemi burada yapƒ±lacak
      }
    }

    function editTeamMember(memberId) {
      showNotification('Edit team member functionality coming soon', 'info');
    }

    function removeTeamMember(memberId) {
      if (confirm('Are you sure you want to remove this team member?')) {
        showNotification('Removing team member...', 'info');
        // Ger√ßek delete i≈ülemi burada yapƒ±lacak
      }
    }

    // Modal kapatma fonksiyonu
    function closeModal() {
      const modals = document.querySelectorAll('.modal-overlay');
      modals.forEach(modal => {
        if (modal.parentNode) {
          document.body.removeChild(modal);
        }
      });
    }

    // Notification fonksiyonu
    function showNotification(message, type = 'info') {
      // CSS animasyonlarƒ± i√ßin style ekle
      if (!document.getElementById('notification-styles')) {
        const style = document.createElement('style');
        style.id = 'notification-styles';
        style.textContent = `
          @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
          }
          @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
          }
        `;
        document.head.appendChild(style);
      }

      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 12px 20px;
        border-radius: 8px;
        background-color: ${type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : type === 'warning' ? '#f59e0b' : '#3b82f6'};
        color: white;
        font-weight: 500;
        z-index: 9999;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        animation: slideIn 0.3s ease;
      `;
      
      notification.textContent = message;
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.style.animation = 'slideOut 0.3s ease';
        setTimeout(() => {
          if (notification.parentNode) {
            document.body.removeChild(notification);
          }
        }, 300);
      }, 3000);
    }

    // Global fonksiyonlar
    window.formatDate = function(dateString) {
      if (!dateString) return 'Unknown date';
      const date = new Date(dateString);
      return date.toLocaleDateString('en-US', {
        year: 'numeric',
        month: 'short',
        day: 'numeric'
      });
    };

    window.formatCurrency = function(amount) {
      return new Intl.NumberFormat('en-US', {
        style: 'currency',
        currency: 'USD'
      }).format(amount || 0);
    };

    window.closeModal = closeModal;
    window.closeEtsyUserModal = closeModal;
    window.closeProducerModal = closeModal;
    window.closeAIToolsModal = closeModal;
    window.closePaymentModal = closeModal;
    window.closeEtsyRegistrationModal = closeModal;
    window.showNotification = showNotification;
    window.saveAITool = saveAITool;
    window.saveEtsyConnection = saveEtsyConnection;
    window.savePODProvider = savePODProvider;
    window.saveTeamMember = saveTeamMember;
    window.savePaymentSettings = savePaymentSettings;
    window.editEtsyShop = editEtsyShop;
    window.deleteEtsyShop = deleteEtsyShop;
    window.editPODProvider = editPODProvider;
    window.deletePODProvider = deletePODProvider;
    window.editTeamMember = editTeamMember;
    window.removeTeamMember = removeTeamMember;
    </script> 
  </body>
</html>
